---
title: "Project"
author: "Junyu Chen"
date: "4/4/2020"
output: 
  html_document:
    toc: true
    number_sections: true
    toc_float: true
    theme: cerulean
    df_print: paged
    self_contained: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message = FALSE, 
                      warning = FALSE,
                      comment = NA)
```

# Introduction
  We have chosen to work on NCAA football data for our project. During this process, we hope to address which qualities of a particular football team leads to positive results for that team. Correlations between defensive, offensive and special team stats hopefully be apparent and good conclusions can be based off of them. Aside from learning how the game is actually played, we hope to gain a deeper insight into the sport. Human eyes are capable of good data analysis, but computing this data with R will hopefully help us learn about the inner mechanics of the game that aren’t very apparent without such computation.

# Methods
In order to accomplish this, the methods we will use are:

- both the dplyr and tidyverse libraries, including ggplot(), select(), mutate()
- linear model
- Multiple regression

```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(ggExtra)
library(WVPlots)

CFB<-read.csv("CFB2019.csv")
```

# Results 
## Does defense really win championships?
```{r}
CFB<-CFB %>%
  separate(Win.Loss, c("Win", "Loss"), "-") %>%
  mutate(Winpct = as.numeric(Win)/Games,Avg.Rank=(Off.Rank+Def.Rank)/2) 

#p1 <- CFB %>% ggplot(aes(Off.Rank,Winpct)) +geom_point()+stat_smooth(method = lm)+labs(title = "Win Percentage vs. Offensive Rank")

#p2 <- CFB %>% ggplot(aes(Def.Rank,Winpct)) +geom_point()+stat_smooth(method = lm)+labs(title = "Win Percentage vs. Defensive Rank")

ScatterHist(CFB, "Off.Rank", "Winpct",
            smoothmethod="lm",
            title="Win Percentage vs. Offensive Rank")

ScatterHist(CFB, "Def.Rank", "Winpct",
            smoothmethod="lm",
            title="Win Percentage vs. Defensive Rank")



lm(Winpct~Off.Rank,data = CFB) #better
lm(Winpct~Def.Rank,data = CFB)
```

## Are special teams of particular value for a team’s performance?
 Adjusted R2 does not increase if a new variable does not provide new information or is completely unrelated. Hence, we could use adjusted R2 for model selection. Here we will creat a full model which contains all feacture related to special teams.
```{r}
# Adjusted R2 does not increase if a new variable does not provide new information or is completely unrelated. Hence, we could use adjusted R2 for model selection.

#creat a full model which contains all feacture related to special teams 
full.model<-lm(Winpct~Kickoff.Return.Rank + 
                 Kickoffs.Returned +
                 #Kickoff.Return.Yards +
                 Kickoff.Return.Touchdowns +
                 Avg.Yard.per.Kickoff.Return +
                 Punt.Return.Rank+ 
                 Redzone.Field.Goals.Made,data = CFB)
#we can see that only the predictor Kickoffs.Returned and Redzone.Field.Goals.Made has the significance star which will inference winpct
summary(full.model)

#create another model which only include the predictor Kickoffs.Returned and Redzone.Field.Goals.Made
full.model.1<-lm(Winpct~ 
                 Kickoffs.Returned +
                 Redzone.Field.Goals.Made,data = CFB)

full.model.1

#winpct = 0.547174-0.005904*Kickoffs.Returned+0.013440*Redzone.Field.Goals.Made
CFB %>%  ggplot(aes(Redzone.Field.Goals.Made,Winpct)) +geom_point(aes(color=Kickoffs.Returned))+stat_smooth(method = lm)
```

## Which Collegiate Conference is the best?
```{r}
#CFB

#CFB %>% 
#  separate(Team, c("College Team","NCAA"),sep = " (") 
```

```{r}
#CFB %>% 
#  separate(Team, c("College Team","NCAA"),sep = " (?=[^ ]+$)")%>%
#  ggplot(aes(x=NCAA,y=Winpct))+
#  geom_bar(stat='identity',fill="blue")+
#  ylab("Win Percentage")+xlab("NCAA")+coord_flip()
```

## What’s the correlation between offensive and defensive performance?

Form cor.test(CFB$Off.Rank,CFB$Def.Rank) function we can get the correlation between offensive and defensive is 0.04547697 which is too small and the p-value = 0.6074 is to large. Then we know that there is no correlation between offensive and defensive performance

```{r}
ScatterHist(CFB, "Def.Rank", "Off.Rank",
            smoothmethod="lm",
            title="Defensive Rank vs. Offensive Rank")

CFB %>% ggplot(aes(Off.Rank,Def.Rank)) +geom_point()+stat_smooth()

lm(Def.Rank~Off.Rank,data = CFB)

cor.test(CFB$Off.Rank,CFB$Def.Rank)
#form cor.test(CFB$Off.Rank,CFB$Def.Rank) function we can get the correlation between offensive and defensive is 0.04547697 which is too small and the p-value = 0.6074 is to large. Then we know that there is no correlation between offensive and defensive performance
```

# Conclusion





# Reference

1. https://www.kaggle.com/jeffgallini/college-football-team-stats-2019